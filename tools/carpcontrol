#!/usr/local/bin/cbsd
#v10.1.3
globalconf="${workdir}/cbsd.conf";
MYARG=""
MYOPTARG="vhid advskew pass ip interface state"
MYDESC="Carp action collector"

set -e
. ${globalconf}
. ${workdir}/carp.subr
set +e

. ${subr}
. ${tools}
. ${initenv}
init $*

set -e
. ${workdir}/carp.subr
set +e

### MAIN
carp_init

args="$*"
[ -z "${args}" ] && exit 0
echo "${args}" >> /tmp/cbsd_carp.log

eval $( echo "${args}" |/usr/bin/tr "@" " "|while read vhid interface state; do
	[ -z "${state}" ] && continue
	echo "export vhid=${vhid}"
	echo "export itnerface=${interface}"
	echo "export state=${state}"
done )

jname="carp1"

case "${state}" in
	[Bb][Aa][Cc][Kk][Uu][Pp])
		jstop inter=0 ${jname}
		;;
	[Mm][Aa][Ss][Tt][Ee][Rr])
		jstart inter=0 ${jname}
		;;
	*)
		err 1 "${MAGENTA}Unknown carp state: ${state}${NORMAL}"
		;;
esac

