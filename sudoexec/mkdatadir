#!/bin/sh
#v10.0.7
globalconf="${workdir}/cbsd.conf";
MYARG="jname"
MYOPTARG=""
MYDESC="Mkdir in datadir for j2prepare"

# TODO
# lock is necessary
set -e
. ${globalconf}
set +e

. ${subr}
init $*

[ -z "${jname}" ] && err 1 "Empty jailname"

readconf zfs.conf

case $zfsfeat in
	0)
		mkdir ${jaildatadir}/${jname}-data 2>/dev/null ||true
		;;
	1)
		ZPOOL=$( /sbin/zfs list -Ho name ${jaildatadir} )
		/sbin/zfs create ${zfs_create_flags} -o mountpoint=${jaildatadir}/${jname}-data ${ZPOOL}/${jname} 2>/dev/null || true
		;;
esac
